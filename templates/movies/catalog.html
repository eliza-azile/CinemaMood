{% extends 'base.html' %}

{% block title %}–ö–∞—Ç–∞–ª–æ–≥ —Ñ–∏–ª—å–º–æ–≤ - CinemaMood{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <h1>üé¨ –ö–∞—Ç–∞–ª–æ–≥ —Ñ–∏–ª—å–º–æ–≤</h1>
        <p class="lead">–ù–∞–π–¥–∏—Ç–µ –∏–¥–µ–∞–ª—å–Ω—ã–π —Ñ–∏–ª—å–º –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</p>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
                <p class="card-text">
                    <strong>{{ stats.total_movies }}</strong> —Ñ–∏–ª—å–º–æ–≤<br>
                    –°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: <strong>{{ stats.avg_duration|floatformat:0 }}</strong> –º–∏–Ω<br>
                    –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥: <strong>{{ stats.avg_rating|floatformat:1 }}</strong>/10
                </p>
            </div>
        </div>
    </div>
</div>

<!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ -->
<div class="card mb-4">
    <div class="card-body">
        <form method="get" class="row g-3">
            <div class="col-md-8">
                {{ search_form.search_query }}
            </div>
            <div class="col-md-2">
                <select name="sort" class="form-select" onchange="this.form.submit()">
                    <option value="-release_year" {% if sort_by=='-release_year' %}selected{% endif %}>–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ
                    </option>
                    <option value="release_year" {% if sort_by=='release_year' %}selected{% endif %}>–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ
                    </option>
                    <option value="-rating" {% if sort_by=='-rating' %}selected{% endif %}>–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É ‚Üì</option>
                    <option value="rating" {% if sort_by=='rating' %}selected{% endif %}>–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É ‚Üë</option>
                    <option value="title" {% if sort_by=='title' %}selected{% endif %}>–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–ê-–Ø)</option>
                    <option value="-title" {% if sort_by=='-title' %}selected{% endif %}>–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–Ø-–ê)</option>
                </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">
                    <i class="bi bi-search"></i> –ù–∞–π—Ç–∏
                </button>
            </div>
        </form>
    </div>
</div>

<!-- –°–µ—Ç–∫–∞ —Ñ–∏–ª—å–º–æ–≤ -->
{% if movies %}
<div class="row">
    {% for movie in movies %}
    <div class="col-lg-4 col-md-6 mb-4">
        <div class="card movie-card h-100">
            {% if movie.poster_url %}
            <img src="{{ movie.poster_url }}" class="card-img-top" alt="{{ movie.title }}"
                style="height: 300px; object-fit: cover;">
            {% else %}
            <div class="card-img-top bg-secondary d-flex align-items-center justify-content-center"
                style="height: 300px;">
                <i class="bi bi-film text-white" style="font-size: 4rem;"></i>
            </div>
            {% endif %}
            <div class="card-body">
                <h5 class="card-title">{{ movie.title }}</h5>
                <h6 class="card-subtitle mb-2 text-muted">{{ movie.release_year }} ‚Ä¢ {{ movie.duration_hours }}</h6>

                <div class="mb-2">
                    <span class="badge bg-primary">‚≠ê {{ movie.rating }}/10</span>
                    {% for genre in movie.genres.all|slice:":3" %}
                    <span class="badge bg-secondary">{{ genre.name }}</span>
                    {% endfor %}
                </div>

                <p class="card-text">{{ movie.description|truncatechars:150 }}</p>
            </div>
            <div class="card-footer">
                <a href="{% url 'movie_detail' movie.id %}" class="btn btn-outline-primary btn-sm">
                    <i class="bi bi-info-circle"></i> –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                </a>
                <span class="float-end text-muted">
                    <small>–ñ–∞–Ω—Ä–æ–≤: {{ movie.genres.count }}</small>
                </span>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
{% if movies.paginator.num_pages > 1 %}
<nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
        {% if movies.has_previous %}
        <li class="page-item">
            <a class="page-link"
                href="?page={{ movies.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}">–ù–∞–∑–∞–¥</a>
        </li>
        {% endif %}

        <li class="page-item disabled">
            <span class="page-link">–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ movies.number }} –∏–∑ {{ movies.paginator.num_pages }}</span>
        </li>

        {% if movies.has_next %}
        <li class="page-item">
            <a class="page-link"
                href="?page={{ movies.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}">–í–ø–µ—Ä–µ–¥</a>
        </li>
        {% endif %}
    </ul>
</nav>
{% endif %}

{% else %}
<div class="alert alert-info text-center">
    <h4>üé≠ –§–∏–ª—å–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
    <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ —Ñ–∏–ª—å–º–æ–≤ –≤ –±–∞–∑—É.</p>
    <a href="{% url 'home' %}" class="btn btn-primary">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø–æ–¥–±–æ—Ä—É</a>
</div>
{% endif %}

<div class="mt-5 text-center">
    <h4>üéØ –ù–µ –Ω–∞—à–ª–∏ —á—Ç–æ –∏—Å–∫–∞–ª–∏?</h4>
    <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞—à —É–º–Ω—ã–π –ø–æ–¥–±–æ—Ä —Ñ–∏–ª—å–º–æ–≤ –ø–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é –∏ –≤—Ä–µ–º–µ–Ω–∏!</p>
    <a href="{% url 'home' %}" class="btn btn-success btn-lg">
        <i class="bi bi-magic"></i> –ü–æ–¥–æ–±—Ä–∞—Ç—å —Ñ–∏–ª—å–º
    </a>
</div>
{% endblock %}