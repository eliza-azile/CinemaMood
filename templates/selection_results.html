{% extends 'base.html' %}
{% load static %}

{% block title %}–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–¥–±–æ—Ä–∞ - CinemaMood{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø–æ–∏—Å–∫–∞ -->
    <div class="card bg-light mb-5 shadow">
        <div class="card-body">
            <h1 class="display-6 mb-4">üé≠ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–¥–±–æ—Ä–∞</h1>
            <div class="row mt-3">
                <div class="col-md-4 mb-3">
                    <p><strong>–í–∞—à–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ:</strong><br>
                        <span class="badge bg-primary fs-6 mt-1">{{ selected_mood }}</span>
                    </p>
                </div>
                <div class="col-md-4 mb-3">
                    <p><strong>–î–æ—Å—Ç—É–ø–Ω–æ–µ –≤—Ä–µ–º—è:</strong><br>
                        <span class="badge bg-secondary fs-6 mt-1">{{ available_time }} –º–∏–Ω—É—Ç</span>
                    </p>
                </div>
                <div class="col-md-4 mb-3">
                    <p><strong>–ù–∞–π–¥–µ–Ω–æ —Ñ–∏–ª—å–º–æ–≤:</strong><br>
                        <span class="badge bg-success fs-6 mt-1">{{ movies|length }}</span>
                    </p>
                </div>
            </div>

            {% if selected_genres %}
            <div class="mt-3">
                <strong>–í—ã–±—Ä–∞–Ω–Ω—ã–µ –∂–∞–Ω—Ä—ã:</strong><br>
                <div class="mt-2">
                    {% for genre in selected_genres %}
                    <span class="badge bg-info me-1 mb-1">{{ genre.name }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <div class="mt-4">
                <a href="{% url 'home' %}" class="btn btn-primary">
                    <i class="bi bi-arrow-left"></i> –°–¥–µ–ª–∞—Ç—å –Ω–æ–≤—ã–π –ø–æ–¥–±–æ—Ä
                </a>
                <a href="{% url 'catalog' %}" class="btn btn-outline-primary ms-2">
                    <i class="bi bi-film"></i> –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Ñ–∏–ª—å–º—ã
                </a>
            </div>
        </div>
    </div>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
    {% if movies %}
    <div class="row mb-4">
        <div class="col-12">
            <h3 class="mb-4">üé¨ –ü–æ–¥—Ö–æ–¥—è—â–∏–µ —Ñ–∏–ª—å–º—ã:</h3>
            <p class="text-muted">–ú—ã –ø–æ–¥–æ–±—Ä–∞–ª–∏ —Ñ–∏–ª—å–º—ã, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –≤–∞—à–µ–º—É –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º.</p>
        </div>

        {% for movie in movies %}
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card h-100 movie-card shadow-sm">
                {% if movie.poster_url %}
                <img src="{{ movie.poster_url }}" class="card-img-top" alt="{{ movie.title }}"
                    style="height: 300px; object-fit: cover;">
                {% else %}
                <div class="card-img-top bg-secondary d-flex align-items-center justify-content-center"
                    style="height: 300px;">
                    <i class="bi bi-film text-white" style="font-size: 4rem;"></i>
                </div>
                {% endif %}

                <div class="card-body">
                    <h5 class="card-title">{{ movie.title }}</h5>

                    <div class="mb-2">
                        <span class="badge bg-primary">{{ movie.release_year }}</span>
                        <span class="badge bg-secondary">{{ movie.duration_hours }}</span>
                        <span class="badge bg-warning text-dark">‚≠ê {{ movie.rating }}</span>
                    </div>

                    <p class="card-text">{{ movie.description|truncatechars:120 }}</p>

                    <div class="mb-3">
                        <small class="text-muted">–ñ–∞–Ω—Ä—ã:</small><br>
                        {% for genre in movie.genres.all|slice:":3" %}
                        <span class="badge bg-light text-dark me-1 mb-1">{{ genre.name }}</span>
                        {% endfor %}
                        {% if movie.genres.all.count > 3 %}
                        <span class="badge bg-light text-dark">+{{ movie.genres.all.count|add:"-3" }}</span>
                        {% endif %}
                    </div>

                    <div class="d-grid gap-2">
                        <a href="{% url 'movie_detail' movie.id %}" class="btn btn-outline-primary">
                            <i class="bi bi-info-circle"></i> –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                        </a>
                        <button class="btn btn-outline-success"
                            onclick="alert('–§–∏–ª—å–º {{ movie.title }} –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≤–∞—à–∏ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ!')">
                            <i class="bi bi-bookmark"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                        </button>
                    </div>
                </div>

                <div class="card-footer bg-transparent">
                    <small class="text-muted">
                        <i class="bi bi-clock"></i> –í–ø–∏—à–µ—Ç—Å—è –≤ –≤–∞—à –∏–Ω—Ç–µ—Ä–≤–∞–ª:
                        <strong>{{ movie.duration }} –º–∏–Ω</strong> –∏–∑ {{ available_time }} –º–∏–Ω
                    </small>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
    <div class="row mt-5">
        <div class="col-md-8 mx-auto">
            {% if user.is_authenticated %}
            <div class="alert alert-success" role="alert">
                <h5><i class="bi bi-check-circle"></i> –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!</h5>
                <p class="mb-0">
                    –≠—Ç–æ—Ç –ø–æ–¥–±–æ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –≤–∞—à–µ–π –∏—Å—Ç–æ—Ä–∏–∏.
                    –í—ã –º–æ–∂–µ—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –µ–≥–æ –ø–æ–∑–∂–µ –≤ —Ä–∞–∑–¥–µ–ª–µ
                    <a href="{% url 'history' %}" class="alert-link">–ò—Å—Ç–æ—Ä–∏—è –ø–æ–¥–±–æ—Ä–æ–≤</a>.
                </p>
            </div>
            {% else %}
            <div class="alert alert-info" role="alert">
                <h5><i class="bi bi-info-circle"></i> –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –ø–æ–¥–±–æ—Ä–æ–≤</h5>
                <p class="mb-3">
                    –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É, —á—Ç–æ–±—ã –≤–∞—à–∏ –ø–æ–¥–±–æ—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
                    –í—ã —Å–º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é, —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –Ω–∞—Ö–æ–¥–∏—Ç—å
                    —Ñ–∏–ª—å–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥—Ö–æ–¥–∏–ª–∏ –≤–∞–º —Ä–∞–Ω—å—à–µ.
                </p>
                <a href="/admin/login/?next={{ request.path }}" class="btn btn-primary">
                    <i class="bi bi-box-arrow-in-right"></i> –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
                </a>
                <a href="{% url 'home' %}" class="btn btn-outline-primary ms-2">
                    –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∫–∞–∫ –≥–æ—Å—Ç—å
                </a>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- –°–æ–≤–µ—Ç—ã –ø–æ –≤—ã–±–æ—Ä—É -->
    <div class="card border-primary mt-5">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="bi bi-lightbulb"></i> –°–æ–≤–µ—Ç—ã –ø–æ –≤—ã–±–æ—Ä—É</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <h6><i class="bi bi-star text-warning"></i> –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Ä–µ–π—Ç–∏–Ω–≥</h6>
                    <p class="small">–§–∏–ª—å–º—ã —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º –≤—ã—à–µ 8.0 –æ–±—ã—á–Ω–æ –ø–æ–ª—É—á–∞—é—Ç –≤—ã—Å–æ–∫–∏–µ –æ—Ü–µ–Ω–∫–∏ –∑—Ä–∏—Ç–µ–ª–µ–π.</p>
                </div>
                <div class="col-md-4">
                    <h6><i class="bi bi-clock text-primary"></i> –£—á–∏—Ç—ã–≤–∞–π—Ç–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</h6>
                    <p class="small">–û—Å—Ç–∞–≤—å—Ç–µ –Ω–µ–º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ø–∞—É–∑—ã –∏ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ —Ñ–∏–ª—å–º–∞ –ø–æ—Å–ª–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞.</p>
                </div>
                <div class="col-md-4">
                    <h6><i class="bi bi-heart text-danger"></i> –ò—Å—Å–ª–µ–¥—É–π—Ç–µ –∂–∞–Ω—Ä—ã</h6>
                    <p class="small">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ñ–∏–ª—å–º—ã —Å–º–µ–∂–Ω—ã—Ö –∂–∞–Ω—Ä–æ–≤ ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –æ—Ç–∫—Ä–æ–µ—Ç–µ –¥–ª—è —Å–µ–±—è –Ω–æ–≤–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ.
                    </p>
                </div>
            </div>
        </div>
    </div>

    {% else %}
    <!-- –ï—Å–ª–∏ —Ñ–∏–ª—å–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã -->
    <div class="text-center py-5">
        <div class="mb-4">
            <i class="bi bi-emoji-frown" style="font-size: 4rem; color: #6c757d;"></i>
        </div>
        <h3 class="mb-3">–ü–æ–¥—Ö–æ–¥—è—â–∏–µ —Ñ–∏–ª—å–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
        <p class="text-muted mb-4">
            –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –ø–æ –≤–∞—à–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º –Ω–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Ñ–∏–ª—å–º—ã.<br>
            –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞:
        </p>
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h5>
                        <ul class="text-start">
                            <li>–£–≤–µ–ª–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –≤—Ä–µ–º—è</li>
                            <li>–í—ã–±–µ—Ä–∏—Ç–µ –±–æ–ª—å—à–µ –∂–∞–Ω—Ä–æ–≤</li>
                            <li>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</li>
                            <li>–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤—Å–µ —Ñ–∏–ª—å–º—ã –≤ <a href="{% url 'catalog' %}">–∫–∞—Ç–∞–ª–æ–≥–µ</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="mt-4">
            <a href="{% url 'home' %}" class="btn btn-primary btn-lg">
                <i class="bi bi-arrow-clockwise"></i> –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
            </a>
        </div>
    </div>
    {% endif %}

    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
    {% if movies %}
    <div class="text-center mt-5 pt-4 border-top">
        <h4 class="mb-4">–ß—Ç–æ –¥–∞–ª—å—à–µ?</h4>
        <div class="d-flex flex-wrap justify-content-center gap-3">
            <a href="{% url 'home' %}" class="btn btn-primary">
                <i class="bi bi-search"></i> –ù–æ–≤—ã–π –ø–æ–¥–±–æ—Ä
            </a>
            <a href="{% url 'catalog' %}" class="btn btn-outline-primary">
                <i class="bi bi-film"></i> –í–µ—Å—å –∫–∞—Ç–∞–ª–æ–≥
            </a>
            {% if user.is_authenticated %}
            <a href="{% url 'history' %}" class="btn btn-outline-info">
                <i class="bi bi-clock-history"></i> –ò—Å—Ç–æ—Ä–∏—è
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_css %}
<style>
    .movie-card {
        transition: all 0.3s ease;
        border: 1px solid #dee2e6;
    }

    .movie-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        border-color: #0d6efd;
    }

    .badge {
        font-weight: 500;
        padding: 0.5em 0.8em;
    }

    .card-img-top {
        border-bottom: 1px solid #dee2e6;
    }
</style>
{% endblock %}