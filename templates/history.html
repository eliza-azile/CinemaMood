{% extends 'base.html' %}

{% block title %}–ò—Å—Ç–æ—Ä–∏—è –ø–æ–¥–±–æ—Ä–æ–≤ - CinemaMood{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1>üìñ –ò—Å—Ç–æ—Ä–∏—è –≤–∞—à–∏—Ö –ø–æ–¥–±–æ—Ä–æ–≤</h1>
        <p class="lead">–ó–¥–µ—Å—å —Ö—Ä–∞–Ω—è—Ç—Å—è –≤—Å–µ –≤–∞—à–∏ –ø–æ–∏—Å–∫–∏ —Ñ–∏–ª—å–º–æ–≤</p>
    </div>
</div>

{% if user.is_authenticated %}
{% if selections %}
<div class="table-responsive">
    <table class="table table-hover">
        <thead class="table-dark">
            <tr>
                <th>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</th>
                <th>–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</th>
                <th>–î–æ—Å—Ç—É–ø–Ω–æ–µ –≤—Ä–µ–º—è</th>
                <th>–ù–∞–π–¥–µ–Ω–æ —Ñ–∏–ª—å–º–æ–≤</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for selection in selections %}
            <tr>
                <td>
                    <strong>{{ selection.search_timestamp|date:"d.m.Y" }}</strong><br>
                    <small class="text-muted">{{ selection.search_timestamp|date:"H:i" }}</small>
                </td>
                <td>
                    <span class="badge bg-info fs-6">
                        {% if selection.selected_mood == 'comedy' %}üòÑ –ö–æ–º–µ–¥–∏–π–Ω–æ–µ
                        {% elif selection.selected_mood == 'drama' %}üé≠ –î—Ä–∞–º–∞—Ç–∏—á–µ—Å–∫–æ–µ
                        {% elif selection.selected_mood == 'adventure' %}üß≠ –ü—Ä–∏–∫–ª—é—á–µ–Ω—á–µ—Å–∫–æ–µ
                        {% elif selection.selected_mood == 'romance' %}üíï –†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ
                        {% elif selection.selected_mood == 'thriller' %}üî™ –¢—Ä–∏–ª–ª–µ—Ä
                        {% elif selection.selected_mood == 'fantasy' %}üßô –§—ç–Ω—Ç–µ–∑–∏
                        {% elif selection.selected_mood == 'action' %}üí• –ë–æ–µ–≤–∏–∫
                        {% elif selection.selected_mood == 'sci_fi' %}üöÄ –ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞
                        {% else %}{{ selection.selected_mood }}{% endif %}
                    </span>
                </td>
                <td>
                    <div class="d-flex align-items-center">
                        <i class="bi bi-clock me-2"></i>
                        <span>{{ selection.available_time }} –º–∏–Ω</span>
                    </div>
                </td>
                <td>
                    {% if selection.matched_movies.count > 0 %}
                    <span class="badge bg-success">{{ selection.matched_movies.count }}</span>
                    {% else %}
                    <span class="badge bg-secondary">0</span>
                    {% endif %}
                </td>
                <td>
                    {% if selection.matched_movies.count > 0 %}
                    <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal"
                        data-bs-target="#modal{{ selection.id }}">
                        <i class="bi bi-eye"></i> –ü–æ–∫–∞–∑–∞—Ç—å
                    </button>
                    {% else %}
                    <span class="text-muted">–ù–µ—Ç —Ñ–∏–ª—å–º–æ–≤</span>
                    {% endif %}
                </td>
            </tr>

            <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Ñ–∏–ª—å–º–∞–º–∏ -->
            {% if selection.matched_movies.count > 0 %}
            <div class="modal fade" id="modal{{ selection.id }}" tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">–ü–æ–¥–±–æ—Ä –æ—Ç {{ selection.search_timestamp|date:"d.m.Y H:i" }}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <p>
                                <strong>–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ:</strong> {{ selection.selected_mood }}<br>
                                <strong>–í—Ä–µ–º—è:</strong> {{ selection.available_time }} –º–∏–Ω—É—Ç<br>
                                <strong>–ù–∞–π–¥–µ–Ω–æ —Ñ–∏–ª—å–º–æ–≤:</strong> {{ selection.matched_movies.count }}
                            </p>

                            <div class="row">
                                {% for movie in selection.matched_movies.all %}
                                <div class="col-md-6 mb-3">
                                    <div class="card">
                                        <div class="card-body">
                                            <h6>{{ movie.title }}</h6>
                                            <p class="mb-1">
                                                <small>{{ movie.release_year }} ‚Ä¢ {{ movie.duration_hours }} ‚Ä¢ ‚≠ê {{
                                                    movie.rating }}</small>
                                            </p>
                                            <a href="{% url 'movie_detail' movie.id %}"
                                                class="btn btn-sm btn-outline-primary mt-2">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="alert alert-info mt-4">
    <h5><i class="bi bi-info-circle"></i> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
    <p>–ò—Å—Ç–æ—Ä–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –ì–æ—Å—Ç–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å, –Ω–æ –∏—Ö –ø–æ–¥–±–æ—Ä—ã –Ω–µ
        —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è.</p>
</div>

{% else %}
<div class="text-center py-5">
    <div class="mb-4">
        <i class="bi bi-clock-history" style="font-size: 4rem; color: #6c757d;"></i>
    </div>
    <h3>–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</h3>
    <p class="lead mb-4">–í—ã –µ—â–µ –Ω–µ –¥–µ–ª–∞–ª–∏ –ø–æ–¥–±–æ—Ä–æ–≤ —Ñ–∏–ª—å–º–æ–≤ —á–µ—Ä–µ–∑ –Ω–∞—à —Å–µ—Ä–≤–∏—Å.</p>
    <a href="{% url 'home' %}" class="btn btn-primary btn-lg">
        <i class="bi bi-magic"></i> –°–¥–µ–ª–∞—Ç—å –ø–µ—Ä–≤—ã–π –ø–æ–¥–±–æ—Ä
    </a>
</div>
{% endif %}
{% else %}
<div class="alert alert-warning text-center py-5">
    <h3><i class="bi bi-exclamation-triangle"></i> –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h3>
    <p class="lead">–ò—Å—Ç–æ—Ä–∏—è –ø–æ–¥–±–æ—Ä–æ–≤ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.</p>
    <div class="mt-4">
        <a href="/admin/login/?next={{ request.path }}" class="btn btn-primary me-2">
            <i class="bi bi-box-arrow-in-right"></i> –í–æ–π—Ç–∏
        </a>
        <a href="{% url 'home' %}" class="btn btn-outline-primary">
            <i class="bi bi-house"></i> –ù–∞ –≥–ª–∞–≤–Ω—É—é
        </a>
    </div>
</div>
{% endif %}
{% endblock %}